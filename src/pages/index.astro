---
export const prerender = false;

import BaseLayout from '../layouts/BaseLayout.astro';
import { db, Contact } from 'astro:db';

// Server-side data fetching
const contacts = await db.select().from(Contact).orderBy(Contact.firstName);
const url = new URL(Astro.request.url);
const selectedId = parseInt(url.searchParams.get('selected') || '0', 10);
const selected = contacts.find(c => c._id === selectedId) || contacts[0];
---

<BaseLayout title="Contacts" contacts={contacts} selected={selected}>
  <h1>{selected.firstName} {selected.lastName}</h1>
  <p>Email: {selected.email}</p>
  <p>Phone: {selected.phone}</p>
</BaseLayout>
